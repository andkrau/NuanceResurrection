; Listing generated by Microsoft (R) Optimizing Compiler Version 14.00.50727.762 

	TITLE	c:\NuanceExperimental\audio.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMTD
INCLUDELIB OLDNAMES

_DATA	SEGMENT
__bad_alloc_Message DD FLAT:$SG12178
_DATA	ENDS
CONST	SEGMENT
$SG12178 DB	'bad allocation', 00H
CONST	ENDS
PUBLIC	?AudioMute@@YAXPAVMPE@@@Z			; AudioMute
EXTRN	?MuteAudio@NuonEnvironment@@QAEXI@Z:PROC	; NuonEnvironment::MuteAudio
EXTRN	?nuonEnv@@3PAVNuonEnvironment@@A:DWORD		; nuonEnv
EXTRN	__RTC_CheckEsp:PROC
EXTRN	__RTC_Shutdown:PROC
EXTRN	__RTC_InitBase:PROC
;	COMDAT rtc$TMZ
; File c:\nuanceexperimental\audio.cpp
rtc$TMZ	SEGMENT
__RTC_Shutdown.rtc$TMZ DD FLAT:__RTC_Shutdown
rtc$TMZ	ENDS
;	COMDAT rtc$IMZ
rtc$IMZ	SEGMENT
__RTC_InitBase.rtc$IMZ DD FLAT:__RTC_InitBase
; Function compile flags: /Odtp /RTCsu
rtc$IMZ	ENDS
_TEXT	SEGMENT
_mpe$ = 8						; size = 4
?AudioMute@@YAXPAVMPE@@@Z PROC				; AudioMute

; 19   : {  

	push	ebp
	mov	ebp, esp

; 20   :   //Mute audio
; 21   :   nuonEnv->MuteAudio(mpe->regs[0]);

	mov	eax, DWORD PTR _mpe$[ebp]
	mov	ecx, DWORD PTR [eax]
	push	ecx
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?MuteAudio@NuonEnvironment@@QAEXI@Z	; NuonEnvironment::MuteAudio

; 22   : }

	cmp	ebp, esp
	call	__RTC_CheckEsp
	pop	ebp
	ret	0
?AudioMute@@YAXPAVMPE@@@Z ENDP				; AudioMute
_TEXT	ENDS
PUBLIC	?AudioReset@@YAXPAVMPE@@@Z			; AudioReset
EXTRN	?RestartAudio@NuonEnvironment@@QAEXXZ:PROC	; NuonEnvironment::RestartAudio
; Function compile flags: /Odtp /RTCsu
_TEXT	SEGMENT
_mpe$ = 8						; size = 4
?AudioReset@@YAXPAVMPE@@@Z PROC				; AudioReset

; 25   : {

	push	ebp
	mov	ebp, esp

; 26   :   nuonEnv->RestartAudio();

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?RestartAudio@NuonEnvironment@@QAEXXZ	; NuonEnvironment::RestartAudio

; 27   :   nuonEnv->pNuonAudioBuffer = 0;

	mov	eax, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [eax+72], 0

; 28   :   nuonEnv->MuteAudio(true);

	push	1
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?MuteAudio@NuonEnvironment@@QAEXI@Z	; NuonEnvironment::MuteAudio

; 29   : }

	cmp	ebp, esp
	call	__RTC_CheckEsp
	pop	ebp
	ret	0
?AudioReset@@YAXPAVMPE@@@Z ENDP				; AudioReset
_TEXT	ENDS
PUBLIC	?AudioQuerySampleRates@@YAXPAVMPE@@@Z		; AudioQuerySampleRates
; Function compile flags: /Odtp /RTCsu
_TEXT	SEGMENT
_mpe$ = 8						; size = 4
?AudioQuerySampleRates@@YAXPAVMPE@@@Z PROC		; AudioQuerySampleRates

; 32   : {

	push	ebp
	mov	ebp, esp

; 33   :   mpe->regs[0] = nuonEnv->nuonSupportedPlaybackRates;

	mov	eax, DWORD PTR _mpe$[ebp]
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	edx, DWORD PTR [ecx+76]
	mov	DWORD PTR [eax], edx

; 34   : }

	pop	ebp
	ret	0
?AudioQuerySampleRates@@YAXPAVMPE@@@Z ENDP		; AudioQuerySampleRates
_TEXT	ENDS
PUBLIC	?AudioSetSampleRate@@YAXPAVMPE@@@Z		; AudioSetSampleRate
EXTRN	?SetAudioPlaybackRate@NuonEnvironment@@QAEXI@Z:PROC ; NuonEnvironment::SetAudioPlaybackRate
; Function compile flags: /Odtp /RTCsu
_TEXT	SEGMENT
_newRate$ = -4						; size = 4
_mpe$ = 8						; size = 4
?AudioSetSampleRate@@YAXPAVMPE@@@Z PROC			; AudioSetSampleRate

; 37   : {

	push	ebp
	mov	ebp, esp
	push	ecx
	mov	DWORD PTR [ebp-4], -858993460		; ccccccccH

; 38   :   uint32 newRate = mpe->regs[0];

	mov	eax, DWORD PTR _mpe$[ebp]
	mov	ecx, DWORD PTR [eax]
	mov	DWORD PTR _newRate$[ebp], ecx

; 39   : 
; 40   :   if(!(newRate & nuonEnv->nuonSupportedPlaybackRates))

	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	eax, DWORD PTR _newRate$[ebp]
	and	eax, DWORD PTR [edx+76]
	jne	SHORT $LN19@AudioSetSa

; 41   :   {
; 42   :     return;

	jmp	$LN20@AudioSetSa
$LN19@AudioSetSa:

; 43   :   }
; 44   : 
; 45   :   if(newRate & RATE_16_KHZ)

	mov	ecx, DWORD PTR _newRate$[ebp]
	and	ecx, 1024				; 00000400H
	je	SHORT $LN18@AudioSetSa

; 46   :   {
; 47   :     nuonEnv->nuonAudioPlaybackRate = 16000;

	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [edx+80], 16000		; 00003e80H
	jmp	$LN17@AudioSetSa
$LN18@AudioSetSa:

; 48   :   }
; 49   :   else if(newRate & RATE_64_KHZ)

	mov	eax, DWORD PTR _newRate$[ebp]
	and	eax, 512				; 00000200H
	je	SHORT $LN16@AudioSetSa

; 50   :   {
; 51   :     nuonEnv->nuonAudioPlaybackRate = 64000;

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [ecx+80], 64000		; 0000fa00H
	jmp	$LN17@AudioSetSa
$LN16@AudioSetSa:

; 52   :   }
; 53   :   else if(newRate & RATE_32_KHZ)

	mov	edx, DWORD PTR _newRate$[ebp]
	and	edx, 256				; 00000100H
	je	SHORT $LN14@AudioSetSa

; 54   :   {
; 55   :     nuonEnv->nuonAudioPlaybackRate = 32000;

	mov	eax, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [eax+80], 32000		; 00007d00H
	jmp	$LN17@AudioSetSa
$LN14@AudioSetSa:

; 56   :   }
; 57   :   else if(newRate & RATE_24_KHZ)

	mov	ecx, DWORD PTR _newRate$[ebp]
	and	ecx, 64					; 00000040H
	je	SHORT $LN12@AudioSetSa

; 58   :   {
; 59   :     nuonEnv->nuonAudioPlaybackRate = 24000;

	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [edx+80], 24000		; 00005dc0H
	jmp	SHORT $LN17@AudioSetSa
$LN12@AudioSetSa:

; 60   :   }
; 61   :   else if(newRate & RATE_96_KHZ)

	mov	eax, DWORD PTR _newRate$[ebp]
	and	eax, 32					; 00000020H
	je	SHORT $LN10@AudioSetSa

; 62   :   {
; 63   :     nuonEnv->nuonAudioPlaybackRate = 96000;

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [ecx+80], 96000		; 00017700H
	jmp	SHORT $LN17@AudioSetSa
$LN10@AudioSetSa:

; 64   :   }
; 65   :   else if(newRate & RATE_48_KHZ)

	mov	edx, DWORD PTR _newRate$[ebp]
	and	edx, 16					; 00000010H
	je	SHORT $LN8@AudioSetSa

; 66   :   {
; 67   :     nuonEnv->nuonAudioPlaybackRate = 48000;

	mov	eax, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [eax+80], 48000		; 0000bb80H
	jmp	SHORT $LN17@AudioSetSa
$LN8@AudioSetSa:

; 68   :   }
; 69   :   else if(newRate & RATE_22_05_KHZ)

	mov	ecx, DWORD PTR _newRate$[ebp]
	and	ecx, 4
	je	SHORT $LN6@AudioSetSa

; 70   :   {
; 71   :     nuonEnv->nuonAudioPlaybackRate = 22050;

	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [edx+80], 22050		; 00005622H
	jmp	SHORT $LN17@AudioSetSa
$LN6@AudioSetSa:

; 72   :   }
; 73   :   else if(newRate & RATE_88_2_KHZ)

	mov	eax, DWORD PTR _newRate$[ebp]
	and	eax, 2
	je	SHORT $LN4@AudioSetSa

; 74   :   {
; 75   :     nuonEnv->nuonAudioPlaybackRate = 88200;

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [ecx+80], 88200		; 00015888H
	jmp	SHORT $LN17@AudioSetSa
$LN4@AudioSetSa:

; 76   :   }
; 77   :   else if(newRate & RATE_44_1_KHZ)

	mov	edx, DWORD PTR _newRate$[ebp]
	and	edx, 1
	je	SHORT $LN2@AudioSetSa

; 78   :   {
; 79   :     nuonEnv->nuonAudioPlaybackRate = 44100;

	mov	eax, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [eax+80], 44100		; 0000ac44H

; 80   :   }
; 81   :   else

	jmp	SHORT $LN17@AudioSetSa
$LN2@AudioSetSa:

; 82   :   {
; 83   :     //default to 32KHZ
; 84   :     nuonEnv->nuonAudioPlaybackRate = 32000;

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [ecx+80], 32000		; 00007d00H
$LN17@AudioSetSa:

; 85   :   }
; 86   : 
; 87   :   nuonEnv->SetAudioPlaybackRate(nuonEnv->nuonAudioPlaybackRate);

	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	eax, DWORD PTR [edx+80]
	push	eax
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?SetAudioPlaybackRate@NuonEnvironment@@QAEXI@Z ; NuonEnvironment::SetAudioPlaybackRate
$LN20@AudioSetSa:

; 88   : }

	add	esp, 4
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	0
?AudioSetSampleRate@@YAXPAVMPE@@@Z ENDP			; AudioSetSampleRate
_TEXT	ENDS
PUBLIC	?AudioQueryChannelMode@@YAXPAVMPE@@@Z		; AudioQueryChannelMode
; Function compile flags: /Odtp /RTCsu
_TEXT	SEGMENT
_mpe$ = 8						; size = 4
?AudioQueryChannelMode@@YAXPAVMPE@@@Z PROC		; AudioQueryChannelMode

; 91   : {

	push	ebp
	mov	ebp, esp

; 92   :   mpe->regs[0] = nuonEnv->nuonAudioChannelMode;

	mov	eax, DWORD PTR _mpe$[ebp]
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	edx, DWORD PTR [ecx+64]
	mov	DWORD PTR [eax], edx

; 93   : }

	pop	ebp
	ret	0
?AudioQueryChannelMode@@YAXPAVMPE@@@Z ENDP		; AudioQueryChannelMode
_TEXT	ENDS
PUBLIC	?AudioSetChannelMode@@YAXPAVMPE@@@Z		; AudioSetChannelMode
EXTRN	?SetAudioVolume@NuonEnvironment@@QAEXI@Z:PROC	; NuonEnvironment::SetAudioVolume
EXTRN	?InitAudio@NuonEnvironment@@QAEXXZ:PROC		; NuonEnvironment::InitAudio
EXTRN	?CloseAudio@NuonEnvironment@@QAEXXZ:PROC	; NuonEnvironment::CloseAudio
EXTRN	?GetBufferSize@NuonEnvironment@@QAEII@Z:PROC	; NuonEnvironment::GetBufferSize
; Function compile flags: /Odtp /RTCsu
_TEXT	SEGMENT
_newMode$ = -4						; size = 4
_mpe$ = 8						; size = 4
?AudioSetChannelMode@@YAXPAVMPE@@@Z PROC		; AudioSetChannelMode

; 96   : {

	push	ebp
	mov	ebp, esp
	push	ecx
	mov	DWORD PTR [ebp-4], -858993460		; ccccccccH

; 97   :   uint32 newMode;
; 98   :   newMode = mpe->regs[0];

	mov	eax, DWORD PTR _mpe$[ebp]
	mov	ecx, DWORD PTR [eax]
	mov	DWORD PTR _newMode$[ebp], ecx

; 99   : 
; 100  :   nuonEnv->nuonAudioChannelMode = newMode;

	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	eax, DWORD PTR _newMode$[ebp]
	mov	DWORD PTR [edx+64], eax

; 101  :   nuonEnv->nuonAudioBufferSize = nuonEnv->GetBufferSize(newMode);

	mov	ecx, DWORD PTR _newMode$[ebp]
	push	ecx
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?GetBufferSize@NuonEnvironment@@QAEII@Z	; NuonEnvironment::GetBufferSize
	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [edx+68], eax

; 102  :   if(newMode & ENABLE_SAMP_INT)

	mov	eax, DWORD PTR _newMode$[ebp]
	and	eax, 1024				; 00000400H
	je	SHORT $LN1@AudioSetCh

; 103  :   {
; 104  :     nuonEnv->cyclesPerAudioInterrupt = 54000000/nuonEnv->nuonAudioPlaybackRate;

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	eax, 54000000				; 0337f980H
	xor	edx, edx
	div	DWORD PTR [ecx+80]
	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [edx+92], eax
$LN1@AudioSetCh:

; 105  :   }
; 106  :   nuonEnv->CloseAudio();

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?CloseAudio@NuonEnvironment@@QAEXXZ	; NuonEnvironment::CloseAudio

; 107  :   nuonEnv->InitAudio();

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?InitAudio@NuonEnvironment@@QAEXXZ	; NuonEnvironment::InitAudio

; 108  :   nuonEnv->RestartAudio();

	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?RestartAudio@NuonEnvironment@@QAEXXZ	; NuonEnvironment::RestartAudio

; 109  :   nuonEnv->SetAudioVolume(255);

	push	255					; 000000ffH
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?SetAudioVolume@NuonEnvironment@@QAEXI@Z ; NuonEnvironment::SetAudioVolume

; 110  : }

	add	esp, 4
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	0
?AudioSetChannelMode@@YAXPAVMPE@@@Z ENDP		; AudioSetChannelMode
_TEXT	ENDS
PUBLIC	?AudioSetDMABuffer@@YAXPAVMPE@@@Z		; AudioSetDMABuffer
EXTRN	?GetPointerToMemory@NuonEnvironment@@QAEPAXPAVMPE@@I_N@Z:PROC ; NuonEnvironment::GetPointerToMemory
; Function compile flags: /Odtp /RTCsu
_TEXT	SEGMENT
_pAudioBuffer$ = -4					; size = 4
_mpe$ = 8						; size = 4
?AudioSetDMABuffer@@YAXPAVMPE@@@Z PROC			; AudioSetDMABuffer

; 113  : {

	push	ebp
	mov	ebp, esp
	push	ecx
	mov	DWORD PTR [ebp-4], -858993460		; ccccccccH

; 114  :   uint32 pAudioBuffer;
; 115  : 
; 116  :   pAudioBuffer = mpe->regs[0];

	mov	eax, DWORD PTR _mpe$[ebp]
	mov	ecx, DWORD PTR [eax]
	mov	DWORD PTR _pAudioBuffer$[ebp], ecx

; 117  :   
; 118  :   if(!pAudioBuffer)

	cmp	DWORD PTR _pAudioBuffer$[ebp], 0
	jne	SHORT $LN2@AudioSetDM

; 119  :   {
; 120  :     pAudioBuffer = pAudioBuffer;

	mov	edx, DWORD PTR _pAudioBuffer$[ebp]
	mov	DWORD PTR _pAudioBuffer$[ebp], edx
$LN2@AudioSetDM:

; 121  :   }
; 122  : 
; 123  :   if((pAudioBuffer >= MPE_ADDR_SPACE_BASE) && (pAudioBuffer < SRAM_0_BASE))

	cmp	DWORD PTR _pAudioBuffer$[ebp], 536870912 ; 20000000H
	jb	SHORT $LN3@AudioSetDM
	cmp	DWORD PTR _pAudioBuffer$[ebp], -1879048192 ; 90000000H
	jae	SHORT $LN3@AudioSetDM

; 124  :   {
; 125  :     nuonEnv->pNuonAudioBuffer = (uint8 *)(nuonEnv->GetPointerToMemory(mpe,pAudioBuffer,false));

	push	0
	mov	eax, DWORD PTR _pAudioBuffer$[ebp]
	push	eax
	mov	ecx, DWORD PTR _mpe$[ebp]
	push	ecx
	mov	ecx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	call	?GetPointerToMemory@NuonEnvironment@@QAEPAXPAVMPE@@I_N@Z ; NuonEnvironment::GetPointerToMemory
	mov	edx, DWORD PTR ?nuonEnv@@3PAVNuonEnvironment@@A ; nuonEnv
	mov	DWORD PTR [edx+72], eax
$LN3@AudioSetDM:

; 126  :   }
; 127  : }

	add	esp, 4
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	0
?AudioSetDMABuffer@@YAXPAVMPE@@@Z ENDP			; AudioSetDMABuffer
_TEXT	ENDS
END
